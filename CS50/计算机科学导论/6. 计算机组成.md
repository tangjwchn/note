# 6. 计算机组成
计算机的组成部件可以分为三大类：中央处理单元（CPU）、主存储器和输入/输出子系统。

## 6.1 中央处理单元
中央处理单元（CPU）用于数据的运算。在大多数体系结构中，它有三个组成部分：算术逻辑单元（ALU）、控制单元（CU，PC 程序计数器，IR 指令寄存器）、寄存器组（R 数据寄存器）。

### 6.1.1 算术逻辑单元
算术逻辑单元对数据进行逻辑、移位和算术运算。

### 6.1.2 寄存器
寄存器是用来存放临时数据的高速独立的存储单元。

**1、数据寄存器**  
在过去，计算机只有几个数据寄存器用来存储输入数据和运算结果。现在，由于越来越多的复杂运算改由硬件设备实现，所以计算机在 CPU 中使用几十个寄存器来提高运算速度，并且需要一些寄存器来保存这些运算的中间结果。

**2、指令寄存器**  
现在，计算机存储的不仅是数据，还有存储在内存中相对应的程序。CPU 的主要职责是：从内存中逐条地取出指令，并将取出的指令存储在指令寄存器中，解释并执行指令。

**3、程序计数器**  
CPU 中另一个通用寄存器是程序计数器。程序计数器中保存着当前正在执行的指令的地址。当前的指令执行完后，计数器将自动加 1，指向下一条指令的内存地址。

### 6.1.3 控制单元
CPU的第三个部分是控制单元，控制单元控制各个子系统的操作。控制是通过从控制单元到其他子系统的信号来进行。

## 6.2 主存储器
主存储器是计算机内的第二个子系统。它是存储单元的集合，每一个存储单元都有唯一的标识，称为地址。数据以称为字的位组的形式在内存中传入和传出。字可以是 8 位、16 位、32 位、64 位（还在增长），如果字是 8 位，一般称为 1 字节。术语字节在计算机科学中使用相当普遍，因此有时称 16 位为 2 字节，32 位为 4 字节。

![存储器](https://picx.zhimg.com/v2-bb117c7a6afd5edf0544374f614028a3_r.jpg)

### 6.2.1 地址空间
在存储器中存取每个字都需要有相应的标识符。尽管程序员使用命名的方式来区分字，但在硬件层次上，每个字都是通过地址来标识的。所有在存储器中标识的独立的地址单元的总数称为地址空间。

**作为位模式的地址**  
由于计算机都是以位模式存储数并进行运算，因此地址本身也是用位模式表示的。如果一个内存是 64K（ $2^{16}$ ），字长为 1 字节，那么就需要 16 位的位模式来确定地址（0 ~ 65535）。通常，如果一个计算机有 N 个字的存储空间，那就需要有 $log_2N$ 位的无符号整数来确定一个存储单元。

### 6.2.2 存储器的类型
主要有两种类型的存储器：RAM 和 ROM。
**1、RAM**  
随机存取存储器（RAM）是计算机中主存的主要组成部分。在随机存取设备中，可以使用存储单元地址来随机存取一个数据项，而不需要存取位于它前面的所有数据项。

RAM的另一个特点是易失性。当系统断电后，信息将丢失。

**2、ROM**  
只读存储器（ROM）的内容是由制造商写进去的。用户只能读但不能写，它的优点是非易失性，当切断电源后，数据也不会丢失。

### 6.2.3 存储器的层次结构
计算机用户需要许多存储器，尤其是速度快且价格低廉的存储器。但这种要求并不总能得到满足。存取速度快的存储器通常都不便宜。因此需要寻找一种折中的办法。解决的办法是采用存储器的层次结构。

最昂贵、最快：寄存器  
价格适中、速度适中：高速缓冲存储器  
最便宜、最慢：主存  

当对速度要求很苛刻时可以使用少量高速存储器。CPU 中的寄存器就是这种存储器。

用适量的中速存储器来存储经常需要访问的数据。

用大量的低速存储器存储那些不经常访问的数据。主存就属于这一类。

### 6.2.4 高速缓冲存储器
高速缓冲存储器的存取速度要比主存快，但是比 CPU 及其内部的寄存器要慢。高速缓冲存储器通常容量较小，且常被置于 CPU 和主存之间。

高速缓冲存储器在任何时候都含有主存中一部分内容的副本。当 CPU 要存取主存中的一个字的时候，将按一下步骤进行：

1. CPU 首先检查高速缓冲存储器。
2. 如果要存取的字存在，CPU 就将它复制；如果不存在，CPU 将从主存中复制一份从需要读取的字开始的数据块。该数据块将覆盖高速缓冲存储器中的内容。
3. CPU 存取高速缓冲存储器并复制该字。

这种方式将提高运算的速度，如果字在高速缓冲存储器中，就立即存取它。如果字不在高速缓冲存储器中，字和整个数据块就会被复制到高速缓冲存储器中。因为很有可能 CPU 在下次存取中需要存取上次存取的第一个字的后续字，所以高速缓冲存储器可以大大提高处理的速度。

据观察，通常计算机花费 80% 的时间来读取 20% 的数据，相同的数据往往被存取多次，所以高速缓冲存储器尽管存储容量小效率却很高。

## 6.3 输入/输出子系统
计算机中的第三个子系统是称为输入/输出子系统的一系列设备。这个子系统可以使计算机与外界通信，并在断电的情况下存储程序和数据。输入/输出设备可以分为两大类：非存储设备和存储设备。

### 6.3.1 非存储设备
非存储设备（键盘、监视器、打印机）使得 CPU/内存可以与外界通信，但它们不能存储信息。

### 6.3.2 存储设备
磁盘被归类为输入/输出设备，它可以存储大量得信息以备后用。它们要比主存便宜得多，而且存储的信息也不易丢失（即使断电信息也不会丢失）。有时称它们为辅助存储设备，通常分为磁介质和光介质两类。

## 6.4 子系统的互连
### 6.4.1 CPU 和存储器的连接
CPU 和存储器之间通常由称为总线的三组线路连接在一起，它们分别是：数据总线、地址总线和控制总线。

**1、 数据总线**  
数据总线是由多根线组成，每一根线上每次传送 1 位的数据。线的数量取决于计算机的字的大小。例如，计算机的字是 32 位（4 字节），那么需要有 32 根线的数据总线，以便同一时刻能够同时传送 32 位的字。

**2、 地址总线**  
地址总线允许访问存储器中的某个字，地址总线的线数取决于存储空间的大小。如果存储器容量为 $2^n$ 个字，那么地址总线一次需要传送 n 位的地址数据。因此它需要 n 根线。

**3、 控制总线**  
控制总线负责在中央处理器和内存之间传送信息。例如，必须有一个代码从 CPU 发往内存，用于指定进行的是读操作还是写操作。控制总线的线数取决于计算机所需要的控制命令的总数。

### 6.4.2 I/O 设备的连接
输入/输出设备不能够直接与连接 CPU 和内存的总线相连。因为输入/输出设备的本质与 CPU 和内存的本质不同，输入/输出设备都是些机电、磁性或光学设备，而 CPU 和内存是电子设备。与 CPU 和内存相比，输入/输出设备的操作速度要慢得多。因此必须要有中介来处理这种差异，输入/输出设备是通过一种被称为输入/输出控制器或接口的器件连接到总线上的。

**控制器**  
控制器，或者说接口，清除了输入/输出设备与 CPU 及内存在本质上的障碍。控制器可以是串行或并行的设备。

有几种控制器至今还在使用，如今最常用的有 SCSI、火线、USB 和 HDMI。

### 6.4.3 输入/输出设备的寻址
通常 CPU 使用相同的总线在主存和输入/输出设备之间读写数据。唯一的不同是指令。如果指令涉及主存中的字，那么数据会在主存和 CPU 之间传送。如果指令涉及输入/输出设备，那么数据会在输入/输出设备和 CPU 之间传送。有两种方法用来对输入/输出设备进行寻址，即 I/O 独立寻址和 I/O 存储器映射寻址。

**1、 I/O 独立寻址**  
在 I/O 独立寻址中，用来读/写内存的指令与用来读/写输入/输出设备的指令是完全不同的。有专门的指令完成对输入/输出设备的测试、控制以及读写操作。每个输入/输出设备有自己的地址。因为指令的不同，所以输入/输出地址可以和内存地址重叠而不会产生混淆。

CPU从内存中读取数据命令 - ‘Read 101’  
CPU从输入/输出设备中读取数据命令 - ‘Input 101’

这里不会发生混淆，因为 Read 指令是规定从内存中读取数据，而 Input 指令则是规定从输入/输出设备中读取数据。

**2、 I/O 存储器映射寻址**  
在 I/O 存储器映射寻址方式中，CPU 将输入/输出控制器中的每一个寄存器都看作内存中的某个存储字。

CPU从内存中读取数据命令 - ‘Read 101’  
CPU从输入/输出设备中读取数据命令 - ‘Read 101’

存储器映射的输入/输出的配置优点在于有一个较小的指令集，所有对内存的操作指令都同样适合于输入/输出设备，其缺点是输入/输出控制器占用了一部分内存地址。

## 6.5 程序执行
当今，通用计算机使用称为程序的一系列指令来处理数据。计算机通过执行程序，将输入数据转换成输出数据。程序和数据都放在内存中。

### 6.5.1 机器周期
CPU 利用重复的机器周期来执行程序中的指令，一步一条，从开始到结束。一个简化的周期包括 3 步：取指令、译码和执行。

**1、 取指令**  
在取指令阶段，控制单元命令系统将下一条将要执行的指令复制到 CPU 的指令寄存器中。被复制的指令地址保存在程序计数器中。复制完成后，程序计数器自动加 1 指向内存中的下一条指令。

**2、 译码**  
机器周期的第二阶段是译码阶段。当指令置于指令寄存器后，该指令将由控制单元负责译码。指令译码的结果是产生一系列系统可以执行的二进制代码。

**3、 执行**  
指令译码完毕后，控制单元发送任务命令到 CPU 的某个部件，例如，控制单元告知系统，让它从内存中加载数据项。

### 6.5.2 输入/输出操作
计算机需要通过命令把数据从 I/O 设备传输到 CPU 和内存。因为输入/输出设备的运行速度比 CPU 慢很多，因此 CPU 的操作在某种程度上必须和输入/输出设备同步。

**1、 程序控制输入/输出**  
在程序控制输入/输出中，采用最简单的一种同步：CPU 等待 I/O 设备。当CPU遇到一条 I/O 指令时，它就停止工作直到数据传输完毕，并不时地查询 I/O 设备的状态。

**2、 中断控制输入/输出**  
在中断控制输入/输出中，首先 CPU 告知 I/O 设备即将开始传输，但是 CPU 并不需要不停地查询 I/O 设备的状态。当 I/O 设备准备好时，它通知（中断）CPU。

**3、 直接存储器存取**  
第三种传输数据的方法是直接存储器存取（DMA）。这种方法用于在高速 I/O 设备间传输大量的数据块。

## 6.6 不同的体系结构
在最近几十年中，计算机的体系结构和组织经历了许多变化。常见的有 CISC 和 RISC 两种体系结构。

### 6.6.1 CISC
CISC 是复杂指令集计算机的缩写。CISC 体系结构的设计策略是使用大量的指令，包括复杂指令。和其他设计相比，在 CISC 中进行程序设计要比在其他设计中容易得多，因为每一项简单或复杂得任务都有一条对应的指令。

指令集的复杂性使得 CPU 和控制单元的电路非常复杂。CISC 体系结构的设计者已经提出减少这种复杂性的解决方案：程序在两个层面上运行。CPU 不直接执行机器语言指令。CPU 只执行被称为微操作的简单操作。复杂指令被转化为一系列简单操作然后由 CPU 执行。这种执行机制需要一个被称为微内存的特殊内存，它负责保存指令集中的每个复杂指令的一系列操作。使用微操作的程序设计被称为微程序设计。

### 6.6.2 RISC
RISC 是精简指令集计算机的缩写。RISC 体系结构的设计策略是使用少量的指令完成最少的简单操作。复杂指令用简单指令子集模拟。在 RISC 中进行程序设计比在其他设计中更难、更费时，因为复杂指令都用简单指令来模拟。

### 6.6.3 流水线
在早期计算机中，每条指令的这三个阶段需要串行完成。换言之，指令 n 需要在指令 n + 1 开始它的阶段之前完成它的所有阶段。现代计算机使用称为流水线的技术来改善吞吐量。这个理念是如果控制单元能同时执行两个或三个阶段，那么下一条指令可以在前一条指令完成前开始。

### 6.6.4 并行处理
计算机传统上有单个控制单元、单个算术逻辑单元、单个内存单元。随着技术的进步和计算机硬件成本的下降，如今可以拥有具有多个控制单元、多个算术逻辑单元和多个内存单元的计算机。这个思想称为并行处理。像流水线一样，并行处理能改善吞吐量。

## 6.7 简单计算机
